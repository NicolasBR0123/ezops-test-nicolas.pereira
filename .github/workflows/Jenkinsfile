


pipeline {
     agent {label "docker-build-node"}
     environment {
     DOCKERHUB_CREDENTIALS = credentials('docker-hub-nicolas')
     }

    
    stages {
    	stage('SCM Checkout'){
     	    steps{
    	    git 'https://github.com/NicolasBR0123/ezops-test-nicolas.pereira' 
    	    }
    	}
    	    
    	stage('Build docker image'){
     	    steps{
    	        sh 'docker build -t web-chat/nodeapp:$BUILD_NUMBER .'
    	    }
    	}
    	     
     	stage('Login to dockerhub'){
     	    steps{
     	        sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
     	    }
     	}   
    	
	stage('Push image'){
	    steps{
	    	sh 'docker push web-chat/nodeapp:$BUILD_NUMBER'
	    }	
	}    
    }
    post{
        always{
	    sh'docker logout'
	}
    }	
        	
}   
